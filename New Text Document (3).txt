<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8" />
    <title>Ù…Ø­ÙˆÙ„ Ø§Ù„Ø¹Ù…Ù„Ø© Ù…Ø¹ Ù‚Ø§ØµØ©ØŒ ØµØ§Ø¯Ø±/ÙˆØ§Ø±Ø¯ ÙˆØ³Ø¬Ù„ ØªØ¯Ù‚ÙŠÙ‚ + Ø·Ø¨Ø§Ø¹Ø©</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #eef2f3;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            direction: rtl;
            margin: 0;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 0 15px rgba(0,0,0,0.1);
            width: 400px;
            max-height: 95vh;
            overflow-y: auto;
        }
        h2 {
            color: #333;
            margin-bottom: 10px;
            text-align: center;
        }
        input, select {
            padding: 10px;
            width: 90%;
            margin-bottom: 10px;
            font-size: 15px;
            border: 1px solid #ccc;
            border-radius: 8px;
        }
        button {
            padding: 10px 15px;
            font-size: 15px;
            margin: 5px;
            background-color: #2196F3;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
        }
        button:hover {
            background-color: #1976D2;
        }
        #result, #balance, #userEmailDisplay {
            margin-top: 10px;
            font-weight: bold;
            color: #222;
            text-align: center;
        }
        #log {
            margin-top: 20px;
            background: #f9f9f9;
            padding: 10px;
            border-radius: 8px;
            max-height: 150px;
            overflow-y: auto;
            font-size: 14px;
            direction: rtl;
        }
        .log-item {
            border-bottom: 1px dashed #ccc;
            padding: 5px 0;
        }
        hr {
            margin: 15px 0;
        }
        @media print {
            body {
                background: white;
                height: auto;
                direction: rtl;
            }
            .container {
                box-shadow: none;
                width: 100%;
                max-height: none;
                overflow: visible;
                padding: 0;
            }
            button, input, select {
                display: none !important;
            }
            #log {
                max-height: none;
                font-size: 12px;
            }
        }
    </style>
</head>
<body>
<div class="container">
    <h2>ğŸ’± Ù…Ø­ÙˆÙ„ Ø§Ù„Ø¹Ù…Ù„Ø© + Ù‚Ø§ØµØ© ğŸ’°</h2>

    <input type="email" id="userEmail" placeholder="Ø£Ø¯Ø®Ù„ Ø¨Ø±ÙŠØ¯Ùƒ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ" />
    <button onclick="saveEmail()">ğŸ“© Ø­ÙØ¸ Ø§Ù„Ø¨Ø±ÙŠØ¯</button>
    <div id="userEmailDisplay"></div>

    <hr>

    <input type="number" id="walletAmount" placeholder="Ø£Ø¯Ø®Ù„ Ù…Ø¨Ù„Øº (Ø¨Ø§Ù„Ø¯ÙˆÙ„Ø§Ø±)" />
    <select id="transactionType">
        <option value="ÙˆØ§Ø±Ø¯">ÙˆØ§Ø±Ø¯ (Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ù‚Ø§ØµØ©)</option>
        <option value="ØµØ§Ø¯Ø±">ØµØ§Ø¯Ø± (Ø®ØµÙ… Ù…Ù† Ø§Ù„Ù‚Ø§ØµØ©)</option>
    </select>
    <button onclick="processTransaction()">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©</button>

    <input type="number" id="usd" placeholder="Ø§Ù„Ù…Ø¨Ù„Øº Ø¨Ø§Ù„Ø¯ÙˆÙ„Ø§Ø± Ù„Ù„ØªØ­ÙˆÙŠÙ„" />
    <input type="number" id="rate" placeholder="Ø³Ø¹Ø± Ø§Ù„ØµØ±Ù" value="1320" />
    <button onclick="convertAndDeduct()">ğŸ” ØªØ­ÙˆÙŠÙ„ ÙˆØ®ØµÙ… Ù…Ù† Ø§Ù„Ù‚Ø§ØµØ©</button>

    <button onclick="resetWallet()" style="background-color: crimson;">â™»ï¸ ØªØµÙÙŠØ± Ø§Ù„Ù‚Ø§ØµØ©</button>
    <button onclick="printPage()" style="background-color: #4CAF50;">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ø³Ø¬Ù„ ÙˆØ§Ù„Ù‚Ø§ØµØ©</button>

    <div id="result"></div>
    <div id="balance">Ø±ØµÙŠØ¯ Ø§Ù„Ù‚Ø§ØµØ©: 0 $</div>

    <hr />
    <h3>ğŸ“‹ Ø³Ø¬Ù„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª</h3>
    <div id="log"></div>
</div>

<script>
    let wallet = 0;
    let log = [];

    window.onload = function () {
        const savedWallet = localStorage.getItem("wallet");
        const savedLog = localStorage.getItem("log");
        const savedEmail = localStorage.getItem("userEmail");

        if (savedWallet) {
            wallet = parseFloat(savedWallet);
            updateBalance();
        }

        if (savedLog) {
            log = JSON.parse(savedLog);
            renderLog();
        }

        if (savedEmail) {
            document.getElementById("userEmailDisplay").innerText = `ğŸ‘¤ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…: ${savedEmail}`;
        }
    };

    function saveEmail() {
        const email = document.getElementById("userEmail").value.trim();
        if (email && email.includes("@")) {
            localStorage.setItem("userEmail", email);
            document.getElementById("userEmailDisplay").innerText = `ğŸ‘¤ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…: ${email}`;
            document.getElementById("userEmail").value = '';
        } else {
            alert("âŒ Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø¨Ø±ÙŠØ¯ Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ØµØ§Ù„Ø­.");
        }
    }

    function processTransaction() {
        const amount = parseFloat(document.getElementById("walletAmount").value);
        const type = document.getElementById("transactionType").value;

        if (isNaN(amount) || amount <= 0) {
            alert("âŒ Ø£Ø¯Ø®Ù„ Ù…Ø¨Ù„ØºÙ‹Ø§ ØµØ§Ù„Ø­Ù‹Ø§ Ù„Ù„Ø¹Ù…Ù„ÙŠØ©.");
            return;
        }

        if (type === "ÙˆØ§Ø±Ø¯") {
            wallet += amount;
            updateBalance();
            saveWallet();
            addLog(`âœ… Ø¹Ù…Ù„ÙŠØ© ÙˆØ§Ø±Ø¯: Ø¥Ø¶Ø§ÙØ© ${amount.toFixed(2)}$ Ù„Ù„Ù‚Ø§ØµØ©.`);
            document.getElementById("result").innerText = `ØªÙ… Ø¥Ø¶Ø§ÙØ© ${amount.toFixed(2)}$ Ù„Ù„Ù‚Ø§ØµØ©.`;
        } else if (type === "ØµØ§Ø¯Ø±") {
            if (amount <= wallet) {
                wallet -= amount;
                updateBalance();
                saveWallet();
                addLog(`âœ… Ø¹Ù…Ù„ÙŠØ© ØµØ§Ø¯Ø±: Ø®ØµÙ… ${amount.toFixed(2)}$ Ù…Ù† Ø§Ù„Ù‚Ø§ØµØ©.`);
                document.getElementById("result").innerText = `ØªÙ… Ø®ØµÙ… ${amount.toFixed(2)}$ Ù…Ù† Ø§Ù„Ù‚Ø§ØµØ©.`;
            } else {
                document.getElementById("result").innerText = "âŒ Ø±ØµÙŠØ¯ Ø§Ù„Ù‚Ø§ØµØ© Ù„Ø§ ÙŠÙƒÙÙŠ.";
                addLog(`âš ï¸ ÙØ´Ù„ Ø¹Ù…Ù„ÙŠØ© ØµØ§Ø¯Ø±: Ø§Ù„Ø±ØµÙŠØ¯ Ù„Ø§ ÙŠÙƒÙÙŠ Ù„Ø®ØµÙ… ${amount.toFixed(2)}$`);
            }
        }
        document.getElementById("walletAmount").value = '';
    }

    function convertAndDeduct() {
        const usd = parseFloat(document.getElementById("usd").value);
        const rate = parseFloat(document.getElementById("rate").value);

        if (isNaN(rate) || rate <= 0) {
            alert("âŒ Ø£Ø¯Ø®Ù„ Ø³Ø¹Ø± ØµØ±Ù ØµØ­ÙŠØ­.");
            return;
        }

        if (!isNaN(usd) && usd > 0) {
            if (usd <= wallet) {
                const iqd = usd * rate;
                wallet -= usd;
                updateBalance();
                saveWallet();
                addLog(`ğŸ’± ØªØ­ÙˆÙŠÙ„ ${usd.toFixed(2)}$ = ${iqd.toFixed(0)} Ø¯.Ø¹ØŒ ÙˆØªÙ… Ø®ØµÙ… Ø§Ù„Ù…Ø¨Ù„Øº Ù…Ù† Ø§Ù„Ù‚Ø§ØµØ©.`);
                document.getElementById("result").innerText = `ØªÙ… Ø§Ù„ØªØ­ÙˆÙŠÙ„: ${usd}$ = ${iqd} Ø¯.Ø¹`;
            } else {
                document.getElementById("result").innerText = "âŒ Ø±ØµÙŠØ¯ Ø§Ù„Ù‚Ø§ØµØ© Ù„Ø§ ÙŠÙƒÙÙŠ.";
                addLog(`âš ï¸ ÙØ´Ù„ Ø§Ù„ØªØ­ÙˆÙŠÙ„: Ø§Ù„Ø±ØµÙŠØ¯ Ù„Ø§ ÙŠÙƒÙÙŠ Ù„ØªØ­ÙˆÙŠÙ„ ${usd}$`);
            }
        } else {
            alert("âŒ Ø£Ø¯Ø®Ù„ Ù…Ø¨Ù„ØºÙ‹Ø§ ØµØ§Ù„Ø­Ù‹Ø§ Ù„Ù„ØªØ­ÙˆÙŠÙ„.");
        }
    }

    function resetWallet() {
        if (confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† ØªØµÙÙŠØ± Ø§Ù„Ù‚Ø§ØµØ©ØŸ")) {
            wallet = 0;
            updateBalance();
            saveWallet();
            addLog("ğŸ—‘ï¸ ØªÙ… ØªØµÙÙŠØ± Ø§Ù„Ù‚Ø§ØµØ©.");
            document.getElementById("result").innerText = "ØªÙ… ØªØµÙÙŠØ± Ø§Ù„Ù‚Ø§ØµØ©.";
        }
    }

    function updateBalance() {
        document.getElementById("balance").innerText = `Ø±ØµÙŠØ¯ Ø§Ù„Ù‚Ø§ØµØ©: ${wallet.toFixed(2)} $`;
    }

    function addLog(entry) {
        const timestamp = new Date().toLocaleString("ar-IQ");
        const logEntry = `${timestamp} - ${entry}`;
        log.unshift(logEntry);
        renderLog();
        localStorage.setItem("log", JSON.stringify(log));
    }

    function renderLog() {
        const logDiv = document.getElementById("log");
        logDiv.innerHTML = '';
        log.slice(0, 50).forEach(item => {
            const div = document.createElement("div");
            div.className = "log-item";
            div.textContent = item;
            logDiv.appendChild(div);
        });
    }

    function saveWallet() {
        localStorage.setItem("wallet", wallet.toFixed(2));
    }

    function printPage() {
        window.print();
    }
</script>
</body>
</html>
